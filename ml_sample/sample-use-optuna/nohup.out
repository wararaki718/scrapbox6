Downloading http://fashion-mnist.s3-website.eu-central-1.amazonaws.com/train-images-idx3-ubyte.gz
Downloading http://fashion-mnist.s3-website.eu-central-1.amazonaws.com/train-images-idx3-ubyte.gz to /Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/dataset/FashionMNIST/raw/train-images-idx3-ubyte.gz
  0%|          | 0/26421880 [00:00<?, ?it/s]  0%|          | 32768/26421880 [00:00<02:26, 180431.43it/s]  0%|          | 65536/26421880 [00:00<02:43, 161554.27it/s]  0%|          | 131072/26421880 [00:00<01:56, 226542.44it/s]  1%|          | 229376/26421880 [00:00<01:22, 317705.24it/s]  2%|▏         | 458752/26421880 [00:01<00:44, 588222.03it/s]  2%|▏         | 622592/26421880 [00:01<00:40, 638553.27it/s]  3%|▎         | 786432/26421880 [00:01<00:39, 652419.46it/s]  4%|▎         | 983040/26421880 [00:01<00:33, 750820.95it/s]  5%|▍         | 1212416/26421880 [00:01<00:29, 841321.16it/s]  5%|▍         | 1310720/26421880 [00:02<00:34, 729753.81it/s]  6%|▌         | 1572864/26421880 [00:02<00:28, 884969.21it/s]  7%|▋         | 1835008/26421880 [00:02<00:24, 986690.79it/s]  8%|▊         | 2097152/26421880 [00:02<00:23, 1057359.40it/s]  9%|▉         | 2359296/26421880 [00:02<00:21, 1124299.88it/s] 10%|█         | 2654208/26421880 [00:03<00:20, 1179646.89it/s] 11%|█         | 2916352/26421880 [00:03<00:19, 1229624.38it/s] 12%|█▏        | 3211264/26421880 [00:03<00:18, 1249901.60it/s] 13%|█▎        | 3506176/26421880 [00:03<00:17, 1277348.96it/s] 14%|█▍        | 3801088/26421880 [00:04<00:17, 1306267.98it/s] 16%|█▌        | 4096000/26421880 [00:04<00:16, 1327125.02it/s] 17%|█▋        | 4390912/26421880 [00:04<00:16, 1355422.39it/s] 18%|█▊        | 4685824/26421880 [00:04<00:15, 1377962.93it/s] 19%|█▉        | 4980736/26421880 [00:04<00:13, 1539724.74it/s] 19%|█▉        | 5144576/26421880 [00:04<00:13, 1525478.17it/s] 20%|██        | 5308416/26421880 [00:05<00:16, 1302097.17it/s] 21%|██        | 5603328/26421880 [00:05<00:15, 1359917.65it/s] 22%|██▏       | 5898240/26421880 [00:05<00:13, 1541025.07it/s] 23%|██▎       | 6062080/26421880 [00:05<00:13, 1516743.53it/s] 24%|██▎       | 6225920/26421880 [00:05<00:15, 1284803.10it/s] 25%|██▍       | 6520832/26421880 [00:05<00:14, 1357117.46it/s] 26%|██▌       | 6815744/26421880 [00:06<00:12, 1522393.86it/s] 26%|██▋       | 6979584/26421880 [00:06<00:12, 1511420.59it/s] 27%|██▋       | 7143424/26421880 [00:06<00:14, 1324439.21it/s] 28%|██▊       | 7438336/26421880 [00:06<00:14, 1350662.12it/s] 29%|██▉       | 7766016/26421880 [00:06<00:13, 1349294.06it/s] 31%|███       | 8060928/26421880 [00:07<00:12, 1419689.16it/s] 32%|███▏      | 8355840/26421880 [00:07<00:11, 1560399.28it/s] 32%|███▏      | 8519680/26421880 [00:07<00:11, 1541771.12it/s] 33%|███▎      | 8683520/26421880 [00:07<00:13, 1273104.60it/s] 34%|███▍      | 8978432/26421880 [00:07<00:12, 1391282.67it/s] 35%|███▌      | 9306112/26421880 [00:07<00:12, 1346558.41it/s] 36%|███▋      | 9601024/26421880 [00:08<00:11, 1441107.24it/s] 37%|███▋      | 9895936/26421880 [00:08<00:10, 1582478.83it/s] 38%|███▊      | 10059776/26421880 [00:08<00:10, 1544877.02it/s] 39%|███▊      | 10223616/26421880 [00:08<00:12, 1274708.31it/s] 40%|███▉      | 10518528/26421880 [00:08<00:10, 1585673.97it/s] 41%|████      | 10715136/26421880 [00:08<00:09, 1608001.05it/s] 41%|████▏     | 10911744/26421880 [00:09<00:11, 1344969.27it/s] 42%|████▏     | 11141120/26421880 [00:09<00:09, 1540888.97it/s] 43%|████▎     | 11337728/26421880 [00:09<00:09, 1567909.42it/s] 44%|████▎     | 11534336/26421880 [00:09<00:11, 1313232.18it/s] 45%|████▍     | 11796480/26421880 [00:09<00:11, 1292469.01it/s] 46%|████▌     | 12091392/26421880 [00:09<00:08, 1606805.04it/s] 47%|████▋     | 12288000/26421880 [00:09<00:08, 1606578.52it/s] 47%|████▋     | 12484608/26421880 [00:10<00:10, 1336082.84it/s] 48%|████▊     | 12746752/26421880 [00:10<00:12, 1121756.40it/s] 50%|████▉     | 13107200/26421880 [00:10<00:08, 1488340.84it/s] 50%|█████     | 13336576/26421880 [00:10<00:09, 1366702.76it/s] 51%|█████▏    | 13565952/26421880 [00:10<00:10, 1276351.78it/s] 52%|█████▏    | 13795328/26421880 [00:11<00:08, 1449161.94it/s] 53%|█████▎    | 13991936/26421880 [00:11<00:08, 1456295.21it/s] 54%|█████▎    | 14155776/26421880 [00:11<00:10, 1212246.74it/s] 54%|█████▍    | 14352384/26421880 [00:11<00:09, 1221392.47it/s] 55%|█████▌    | 14614528/26421880 [00:11<00:08, 1373614.27it/s] 56%|█████▌    | 14778368/26421880 [00:11<00:08, 1345667.06it/s] 57%|█████▋    | 14942208/26421880 [00:12<00:09, 1154390.80it/s] 58%|█████▊    | 15204352/26421880 [00:12<00:11, 1010932.19it/s] 59%|█████▉    | 15532032/26421880 [00:12<00:08, 1324470.14it/s] 60%|█████▉    | 15728640/26421880 [00:12<00:08, 1214740.87it/s] 60%|██████    | 15925248/26421880 [00:12<00:08, 1214213.43it/s] 61%|██████    | 16121856/26421880 [00:13<00:08, 1240131.09it/s] 62%|██████▏   | 16285696/26421880 [00:13<00:08, 1226793.95it/s] 62%|██████▏   | 16416768/26421880 [00:13<00:09, 1019650.84it/s] 63%|██████▎   | 16613376/26421880 [00:13<00:08, 1094522.36it/s] 64%|██████▎   | 16809984/26421880 [00:13<00:08, 1154045.58it/s] 64%|██████▍   | 16941056/26421880 [00:13<00:08, 1112623.34it/s] 65%|██████▍   | 17104896/26421880 [00:13<00:09, 1013951.31it/s] 65%|██████▌   | 17301504/26421880 [00:14<00:07, 1207550.90it/s] 66%|██████▌   | 17465344/26421880 [00:14<00:07, 1205573.96it/s] 67%|██████▋   | 17596416/26421880 [00:14<00:08, 1015079.49it/s] 67%|██████▋   | 17825792/26421880 [00:14<00:07, 1132976.43it/s] 68%|██████▊   | 18055168/26421880 [00:14<00:06, 1245623.18it/s] 69%|██████▉   | 18186240/26421880 [00:14<00:07, 1172239.09it/s] 69%|██████▉   | 18317312/26421880 [00:15<00:07, 1091865.62it/s] 70%|███████   | 18546688/26421880 [00:15<00:06, 1222926.80it/s] 71%|███████   | 18677760/26421880 [00:15<00:06, 1164585.24it/s] 71%|███████▏  | 18841600/26421880 [00:15<00:06, 1143118.21it/s] 72%|███████▏  | 19070976/26421880 [00:15<00:05, 1256750.08it/s] 73%|███████▎  | 19202048/26421880 [00:15<00:06, 1189832.16it/s] 73%|███████▎  | 19333120/26421880 [00:15<00:06, 1098012.59it/s] 74%|███████▍  | 19562496/26421880 [00:16<00:05, 1227027.33it/s] 75%|███████▍  | 19693568/26421880 [00:16<00:05, 1165068.64it/s] 75%|███████▌  | 19857408/26421880 [00:16<00:05, 1149355.52it/s] 76%|███████▌  | 20086784/26421880 [00:16<00:05, 1255775.09it/s] 77%|███████▋  | 20217856/26421880 [00:16<00:05, 1191599.16it/s] 77%|███████▋  | 20381696/26421880 [00:16<00:05, 1046558.05it/s] 78%|███████▊  | 20578304/26421880 [00:16<00:04, 1227634.24it/s] 78%|███████▊  | 20709376/26421880 [00:17<00:04, 1191210.61it/s] 79%|███████▉  | 20873216/26421880 [00:17<00:04, 1166473.64it/s] 80%|███████▉  | 21102592/26421880 [00:17<00:04, 1246650.14it/s] 80%|████████  | 21233664/26421880 [00:17<00:04, 1207799.20it/s] 81%|████████  | 21397504/26421880 [00:17<00:04, 1042996.49it/s] 82%|████████▏ | 21594112/26421880 [00:17<00:03, 1226258.98it/s] 82%|████████▏ | 21757952/26421880 [00:17<00:03, 1263777.51it/s] 83%|████████▎ | 21921792/26421880 [00:18<00:04, 1079831.75it/s] 84%|████████▎ | 22118400/26421880 [00:18<00:03, 1240851.67it/s] 84%|████████▍ | 22282240/26421880 [00:18<00:03, 1290419.59it/s] 85%|████████▍ | 22446080/26421880 [00:18<00:03, 1081862.38it/s] 86%|████████▌ | 22642688/26421880 [00:18<00:03, 1249563.00it/s] 86%|████████▋ | 22806528/26421880 [00:18<00:02, 1307201.31it/s] 87%|████████▋ | 22970368/26421880 [00:18<00:03, 1094373.09it/s] 88%|████████▊ | 23134208/26421880 [00:19<00:02, 1189849.43it/s] 88%|████████▊ | 23265280/26421880 [00:19<00:02, 1188469.50it/s] 89%|████████▊ | 23396352/26421880 [00:19<00:02, 1178369.67it/s] 89%|████████▉ | 23527424/26421880 [00:19<00:02, 1209816.04it/s] 90%|████████▉ | 23658496/26421880 [00:19<00:02, 1189703.43it/s] 90%|█████████ | 23822336/26421880 [00:19<00:01, 1308129.55it/s] 91%|█████████ | 23986176/26421880 [00:19<00:01, 1257911.06it/s] 92%|█████████▏| 24215552/26421880 [00:19<00:01, 1235828.18it/s] 92%|█████████▏| 24379392/26421880 [00:20<00:01, 1329072.06it/s] 93%|█████████▎| 24543232/26421880 [00:20<00:01, 1126297.11it/s] 94%|█████████▍| 24772608/26421880 [00:20<00:01, 1279387.10it/s] 95%|█████████▍| 25034752/26421880 [00:20<00:01, 1276533.83it/s] 95%|█████████▌| 25198592/26421880 [00:20<00:00, 1348857.24it/s] 96%|█████████▌| 25362432/26421880 [00:20<00:00, 1348230.16it/s] 97%|█████████▋| 25559040/26421880 [00:20<00:00, 1483632.94it/s] 97%|█████████▋| 25722880/26421880 [00:21<00:00, 1219668.82it/s] 98%|█████████▊| 25919488/26421880 [00:21<00:00, 1332066.98it/s] 99%|█████████▉| 26116096/26421880 [00:21<00:00, 1476728.16it/s] 99%|█████████▉| 26279936/26421880 [00:21<00:00, 1392523.77it/s]100%|██████████| 26421880/26421880 [00:21<00:00, 1227499.16it/s]
Extracting /Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/dataset/FashionMNIST/raw/train-images-idx3-ubyte.gz to /Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/dataset/FashionMNIST/raw

Downloading http://fashion-mnist.s3-website.eu-central-1.amazonaws.com/train-labels-idx1-ubyte.gz
Downloading http://fashion-mnist.s3-website.eu-central-1.amazonaws.com/train-labels-idx1-ubyte.gz to /Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/dataset/FashionMNIST/raw/train-labels-idx1-ubyte.gz
  0%|          | 0/29515 [00:00<?, ?it/s]100%|██████████| 29515/29515 [00:00<00:00, 132696.42it/s]100%|██████████| 29515/29515 [00:00<00:00, 132540.43it/s]
Extracting /Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/dataset/FashionMNIST/raw/train-labels-idx1-ubyte.gz to /Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/dataset/FashionMNIST/raw

Downloading http://fashion-mnist.s3-website.eu-central-1.amazonaws.com/t10k-images-idx3-ubyte.gz
Downloading http://fashion-mnist.s3-website.eu-central-1.amazonaws.com/t10k-images-idx3-ubyte.gz to /Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/dataset/FashionMNIST/raw/t10k-images-idx3-ubyte.gz
  0%|          | 0/4422102 [00:00<?, ?it/s]  1%|          | 32768/4422102 [00:00<00:29, 147526.05it/s]  1%|▏         | 65536/4422102 [00:00<00:29, 148563.14it/s]  3%|▎         | 131072/4422102 [00:00<00:19, 217408.51it/s]  5%|▌         | 229376/4422102 [00:00<00:13, 309230.88it/s] 11%|█         | 491520/4422102 [00:01<00:06, 600269.85it/s] 16%|█▋        | 720896/4422102 [00:01<00:04, 782581.75it/s] 19%|█▊        | 819200/4422102 [00:01<00:05, 682267.86it/s] 27%|██▋       | 1179648/4422102 [00:01<00:03, 1002153.85it/s] 34%|███▍      | 1507328/4422102 [00:01<00:02, 1167027.21it/s] 42%|████▏     | 1867776/4422102 [00:02<00:01, 1320898.26it/s] 49%|████▉     | 2162688/4422102 [00:02<00:01, 1287070.48it/s] 52%|█████▏    | 2293760/4422102 [00:02<00:01, 1122862.03it/s] 64%|██████▎   | 2818048/4422102 [00:02<00:01, 1523944.91it/s] 70%|██████▉   | 3080192/4422102 [00:03<00:00, 1434085.77it/s] 76%|███████▌  | 3342336/4422102 [00:03<00:00, 1369532.03it/s] 82%|████████▏ | 3637248/4422102 [00:03<00:00, 1367552.69it/s] 88%|████████▊ | 3899392/4422102 [00:03<00:00, 1327361.39it/s] 95%|█████████▍| 4194304/4422102 [00:03<00:00, 1340963.20it/s]100%|██████████| 4422102/4422102 [00:03<00:00, 1129421.03it/s]
Extracting /Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/dataset/FashionMNIST/raw/t10k-images-idx3-ubyte.gz to /Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/dataset/FashionMNIST/raw

Downloading http://fashion-mnist.s3-website.eu-central-1.amazonaws.com/t10k-labels-idx1-ubyte.gz
Downloading http://fashion-mnist.s3-website.eu-central-1.amazonaws.com/t10k-labels-idx1-ubyte.gz to /Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/dataset/FashionMNIST/raw/t10k-labels-idx1-ubyte.gz
  0%|          | 0/5148 [00:00<?, ?it/s]100%|██████████| 5148/5148 [00:00<00:00, 5566454.50it/s]
[I 2024-01-16 15:12:36,025] A new study created in memory with name: no-name-463a6e88-e8e8-44af-87e2-07472808e953
/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/experiment.py:38: FutureWarning: suggest_loguniform has been deprecated in v3.0.0. This feature will be removed in v6.0.0. See https://github.com/optuna/optuna/releases/tag/v3.0.0. Use suggest_float(..., log=True) instead.
  lr = trial.suggest_loguniform('lr', 1e-5, 1e-1)
[W 2024-01-16 15:12:36,046] Trial 0 failed with parameters: {'n_layers': 3, 'n_hidden_layer_0': 26, 'dropout_layer_0': 0.2083232921184801, 'n_hidden_layer_1': 31, 'dropout_layer_1': 0.49783954770215005, 'n_hidden_layer_2': 34, 'dropout_layer_2': 0.47392939840754944, 'optimizer': 'RMSprop', 'lr': 5.396217525127346e-05} because of the following error: RuntimeError('mat1 and mat2 shapes cannot be multiplied (3584x28 and 784x26)').
Traceback (most recent call last):
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/optuna/study/_optimize.py", line 200, in _run_trial
    value_or_values = func(trial)
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/experiment.py", line 43, in experiment
    loss = _train(model, train_loader, optimizer, criterion)
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/experiment.py", line 14, in _train
    y_preds = model(data)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/model.py", line 24, in forward
    return self.model(x)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/container.py", line 215, in forward
    input = module(input)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/linear.py", line 114, in forward
    return F.linear(input, self.weight, self.bias)
RuntimeError: mat1 and mat2 shapes cannot be multiplied (3584x28 and 784x26)
[W 2024-01-16 15:12:36,047] Trial 0 failed with value None.
Extracting /Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/dataset/FashionMNIST/raw/t10k-labels-idx1-ubyte.gz to /Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/dataset/FashionMNIST/raw

start study:
Traceback (most recent call last):
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/main.py", line 42, in <module>
    main()
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/main.py", line 18, in main
    study.optimize(objective, n_trials=10, timeout=600)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/optuna/study/study.py", line 451, in optimize
    _optimize(
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/optuna/study/_optimize.py", line 66, in _optimize
    _optimize_sequential(
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/optuna/study/_optimize.py", line 163, in _optimize_sequential
    frozen_trial = _run_trial(study, func, catch)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/optuna/study/_optimize.py", line 251, in _run_trial
    raise func_err
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/optuna/study/_optimize.py", line 200, in _run_trial
    value_or_values = func(trial)
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/experiment.py", line 43, in experiment
    loss = _train(model, train_loader, optimizer, criterion)
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/experiment.py", line 14, in _train
    y_preds = model(data)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/model.py", line 24, in forward
    return self.model(x)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/container.py", line 215, in forward
    input = module(input)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/linear.py", line 114, in forward
    return F.linear(input, self.weight, self.bias)
RuntimeError: mat1 and mat2 shapes cannot be multiplied (3584x28 and 784x26)
[I 2024-01-16 15:13:32,623] A new study created in memory with name: no-name-bb8d25d3-bde4-4706-92a3-99ed692aac0c
/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/experiment.py:38: FutureWarning: suggest_loguniform has been deprecated in v3.0.0. This feature will be removed in v6.0.0. See https://github.com/optuna/optuna/releases/tag/v3.0.0. Use suggest_float(..., log=True) instead.
  lr = trial.suggest_loguniform('lr', 1e-5, 1e-1)
[W 2024-01-16 15:13:32,635] Trial 0 failed with parameters: {'n_layers': 3, 'n_hidden_layer_0': 43, 'dropout_layer_0': 0.26967757451915675, 'n_hidden_layer_1': 34, 'dropout_layer_1': 0.30310892687274477, 'n_hidden_layer_2': 24, 'dropout_layer_2': 0.42546426229034917, 'optimizer': 'RMSprop', 'lr': 0.004073644158204215} because of the following error: RuntimeError('mat1 and mat2 shapes cannot be multiplied (3584x28 and 784x43)').
Traceback (most recent call last):
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/optuna/study/_optimize.py", line 200, in _run_trial
    value_or_values = func(trial)
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/experiment.py", line 43, in experiment
    loss = _train(model, train_loader, optimizer, criterion)
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/experiment.py", line 14, in _train
    y_preds = model(data)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/model.py", line 24, in forward
    return self.model(x)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/container.py", line 215, in forward
    input = module(input)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/linear.py", line 114, in forward
    return F.linear(input, self.weight, self.bias)
RuntimeError: mat1 and mat2 shapes cannot be multiplied (3584x28 and 784x43)
[W 2024-01-16 15:13:32,635] Trial 0 failed with value None.
start study:
Traceback (most recent call last):
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/main.py", line 42, in <module>
    main()
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/main.py", line 18, in main
    study.optimize(objective, n_trials=10, timeout=600)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/optuna/study/study.py", line 451, in optimize
    _optimize(
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/optuna/study/_optimize.py", line 66, in _optimize
    _optimize_sequential(
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/optuna/study/_optimize.py", line 163, in _optimize_sequential
    frozen_trial = _run_trial(study, func, catch)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/optuna/study/_optimize.py", line 251, in _run_trial
    raise func_err
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/optuna/study/_optimize.py", line 200, in _run_trial
    value_or_values = func(trial)
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/experiment.py", line 43, in experiment
    loss = _train(model, train_loader, optimizer, criterion)
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/experiment.py", line 14, in _train
    y_preds = model(data)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/model.py", line 24, in forward
    return self.model(x)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/container.py", line 215, in forward
    input = module(input)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/linear.py", line 114, in forward
    return F.linear(input, self.weight, self.bias)
RuntimeError: mat1 and mat2 shapes cannot be multiplied (3584x28 and 784x43)
[I 2024-01-16 15:17:21,386] A new study created in memory with name: no-name-d3e75b72-bf85-443b-8dc3-62505ad4bb29
/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/experiment.py:38: FutureWarning: suggest_loguniform has been deprecated in v3.0.0. This feature will be removed in v6.0.0. See https://github.com/optuna/optuna/releases/tag/v3.0.0. Use suggest_float(..., log=True) instead.
  lr = trial.suggest_loguniform('lr', 1e-5, 1e-1)
[W 2024-01-16 15:17:21,398] Trial 0 failed with parameters: {'n_layers': 3, 'n_hidden_layer_0': 19, 'dropout_layer_0': 0.21790871930682515, 'n_hidden_layer_1': 29, 'dropout_layer_1': 0.4681240352009809, 'n_hidden_layer_2': 18, 'dropout_layer_2': 0.4816069140278845, 'optimizer': 'Adam', 'lr': 0.004049164388564493} because of the following error: RuntimeError('mat1 and mat2 shapes cannot be multiplied (3584x28 and 784x19)').
Traceback (most recent call last):
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/optuna/study/_optimize.py", line 200, in _run_trial
    value_or_values = func(trial)
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/experiment.py", line 43, in experiment
    loss = _train(model, train_loader, optimizer, criterion)
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/experiment.py", line 14, in _train
    y_preds = model(data)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/model.py", line 25, in forward
    return self.model(x)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/container.py", line 215, in forward
    input = module(input)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/linear.py", line 114, in forward
    return F.linear(input, self.weight, self.bias)
RuntimeError: mat1 and mat2 shapes cannot be multiplied (3584x28 and 784x19)
[W 2024-01-16 15:17:21,398] Trial 0 failed with value None.
start study:
Traceback (most recent call last):
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/main.py", line 42, in <module>
    main()
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/main.py", line 18, in main
    study.optimize(objective, n_trials=10, timeout=600)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/optuna/study/study.py", line 451, in optimize
    _optimize(
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/optuna/study/_optimize.py", line 66, in _optimize
    _optimize_sequential(
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/optuna/study/_optimize.py", line 163, in _optimize_sequential
    frozen_trial = _run_trial(study, func, catch)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/optuna/study/_optimize.py", line 251, in _run_trial
    raise func_err
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/optuna/study/_optimize.py", line 200, in _run_trial
    value_or_values = func(trial)
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/experiment.py", line 43, in experiment
    loss = _train(model, train_loader, optimizer, criterion)
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/experiment.py", line 14, in _train
    y_preds = model(data)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/model.py", line 25, in forward
    return self.model(x)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/container.py", line 215, in forward
    input = module(input)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/kyohei.watarai/.pyenv/versions/3.10.8/lib/python3.10/site-packages/torch/nn/modules/linear.py", line 114, in forward
    return F.linear(input, self.weight, self.bias)
RuntimeError: mat1 and mat2 shapes cannot be multiplied (3584x28 and 784x19)
[I 2024-01-16 15:20:19,524] A new study created in memory with name: no-name-39631054-d7cb-436d-917e-f257b0a16b28
/Users/kyohei.watarai/workspace/scrapbox6/ml_sample/sample-use-optuna/experiment.py:38: FutureWarning: suggest_loguniform has been deprecated in v3.0.0. This feature will be removed in v6.0.0. See https://github.com/optuna/optuna/releases/tag/v3.0.0. Use suggest_float(..., log=True) instead.
  lr = trial.suggest_loguniform('lr', 1e-5, 1e-1)
[I 2024-01-16 15:20:41,657] Trial 0 finished with value: 25.40506329113924 and parameters: {'n_layers': 3, 'n_hidden_layer_0': 45, 'dropout_layer_0': 0.2533757474224478, 'n_hidden_layer_1': 63, 'dropout_layer_1': 0.32068788148614336, 'n_hidden_layer_2': 40, 'dropout_layer_2': 0.22922069477378829, 'optimizer': 'RMSprop', 'lr': 0.031054214803011043}. Best is trial 0 with value: 25.40506329113924.
[I 2024-01-16 15:21:02,625] Trial 1 finished with value: 85.88607594936708 and parameters: {'n_layers': 1, 'n_hidden_layer_0': 23, 'dropout_layer_0': 0.24193933330833015, 'optimizer': 'RMSprop', 'lr': 1.2090835414360017e-05}. Best is trial 1 with value: 85.88607594936708.
[I 2024-01-16 15:21:24,320] Trial 2 finished with value: 91.83544303797468 and parameters: {'n_layers': 1, 'n_hidden_layer_0': 62, 'dropout_layer_0': 0.4893791392145684, 'optimizer': 'Adam', 'lr': 1.3617616733380886e-05}. Best is trial 2 with value: 91.83544303797468.
[I 2024-01-16 15:21:45,943] Trial 3 finished with value: 58.607594936708864 and parameters: {'n_layers': 3, 'n_hidden_layer_0': 19, 'dropout_layer_0': 0.20437468329226222, 'n_hidden_layer_1': 35, 'dropout_layer_1': 0.4651568053237704, 'n_hidden_layer_2': 20, 'dropout_layer_2': 0.22853903386969354, 'optimizer': 'RMSprop', 'lr': 1.4072613258787497e-05}. Best is trial 2 with value: 91.83544303797468.
[I 2024-01-16 15:22:06,433] Trial 4 finished with value: 93.82278481012658 and parameters: {'n_layers': 3, 'n_hidden_layer_0': 22, 'dropout_layer_0': 0.2585122938509945, 'n_hidden_layer_1': 40, 'dropout_layer_1': 0.27102721229464144, 'n_hidden_layer_2': 24, 'dropout_layer_2': 0.4719142243181414, 'optimizer': 'SGD', 'lr': 0.019984743308012982}. Best is trial 4 with value: 93.82278481012658.
[I 2024-01-16 15:22:08,605] Trial 5 pruned. 
[I 2024-01-16 15:22:10,688] Trial 6 pruned. 
[I 2024-01-16 15:22:32,576] Trial 7 finished with value: 102.0886075949367 and parameters: {'n_layers': 3, 'n_hidden_layer_0': 44, 'dropout_layer_0': 0.40440724808682604, 'n_hidden_layer_1': 50, 'dropout_layer_1': 0.4660643659550775, 'n_hidden_layer_2': 36, 'dropout_layer_2': 0.36034308296908835, 'optimizer': 'RMSprop', 'lr': 0.00021463515271404}. Best is trial 7 with value: 102.0886075949367.
[I 2024-01-16 15:22:55,001] Trial 8 finished with value: 99.18987341772151 and parameters: {'n_layers': 3, 'n_hidden_layer_0': 53, 'dropout_layer_0': 0.4613994757975536, 'n_hidden_layer_1': 16, 'dropout_layer_1': 0.3104795418854224, 'n_hidden_layer_2': 30, 'dropout_layer_2': 0.380947998433122, 'optimizer': 'Adam', 'lr': 0.00646257441723123}. Best is trial 7 with value: 102.0886075949367.
[I 2024-01-16 15:23:15,184] Trial 9 finished with value: 97.9746835443038 and parameters: {'n_layers': 2, 'n_hidden_layer_0': 23, 'dropout_layer_0': 0.2307725273066989, 'n_hidden_layer_1': 58, 'dropout_layer_1': 0.39636193431736144, 'optimizer': 'SGD', 'lr': 0.008976883621507316}. Best is trial 7 with value: 102.0886075949367.
start study:
## study stats
number of finished trials: 10
number of pruned trials: 2
number of complete trials: 8

## best trials
value: 102.0886075949367
params:
    n_layers: 3
    n_hidden_layer_0: 44
    dropout_layer_0: 0.40440724808682604
    n_hidden_layer_1: 50
    dropout_layer_1: 0.4660643659550775
    n_hidden_layer_2: 36
    dropout_layer_2: 0.36034308296908835
    optimizer: RMSprop
    lr: 0.00021463515271404

DONE
